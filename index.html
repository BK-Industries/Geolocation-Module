<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Play Geolocation Module by edulify</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Play Geolocation Module</h1>
        <p class="header">This is a play module for IP based geolocation</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/edulify/play-geolocation-module.edulify.com/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/edulify/play-geolocation-module.edulify.com/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/edulify/play-geolocation-module.edulify.com">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/edulify">edulify</a></p>


      </header>
      <section>
        <h1>
<a id="play-geolocation-plugin" class="anchor" href="#play-geolocation-plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Play Geolocation Plugin</h1>

<p><a href="https://travis-ci.org/edulify/play-geolocation-module.edulify.com"><img src="https://travis-ci.org/edulify/play-geolocation-module.edulify.com.svg" alt="Build Status"></a></p>

<p>This is a play module for IP based geolocation. Currently, the module supports use of one of the following service to retrieve the IP data:</p>

<h4>
<a id="freegeoip" class="anchor" href="#freegeoip" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="http://freegeoip.net/">Freegeoip</a>
</h4>

<blockquote>
<p>freegeoip.net provides a public HTTP API for software developers to search the geolocation of IP addresses. It uses a database of IP addresses that are associated to cities along with other relevant information like time zone, latitude and longitude.</p>
</blockquote>

<h4>
<a id="maxmind-geoip2-country" class="anchor" href="#maxmind-geoip2-country" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://www.maxmind.com/en/country">Maxmind GeoIP2 Country</a>
</h4>

<blockquote>
<p>Determine an Internet visitor's country based on their IP address.</p>
</blockquote>

<p>However, support to other geolocation services is possible using the API provided by this plugin.</p>

<h2>
<a id="how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to use</h2>

<p>The first step is include the the dependency in your <code>build.sbt</code> or <code>project/Build.scala</code> file:</p>

<h4>
<a id="buildsbt" class="anchor" href="#buildsbt" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>build.sbt</code>
</h4>

<div class="highlight highlight-scala"><pre>name <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>sitemapper-java-sample<span class="pl-pds">"</span></span>

version <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>1.0-SNAPSHOT<span class="pl-pds">"</span></span>

<span class="pl-s">lazy</span> <span class="pl-k">val</span> <span class="pl-en">root</span> <span class="pl-k">=</span> (project in file(<span class="pl-s1"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>)).enablePlugins(<span class="pl-en">PlayJava</span>)

scalaVersion <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>2.11.5<span class="pl-pds">"</span></span>

libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
  <span class="pl-c">// Add your project dependencies here,</span>
  javaCore,
  javaJdbc,
  javaEbean,
  <span class="pl-s1"><span class="pl-pds">"</span>com.edulify<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s1"><span class="pl-pds">"</span>geolocation<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s1"><span class="pl-pds">"</span>1.4.0<span class="pl-pds">"</span></span>
)

resolvers <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
  <span class="pl-en">Resolver</span>.url(<span class="pl-s1"><span class="pl-pds">"</span>Edulify Repository<span class="pl-pds">"</span></span>, url(<span class="pl-s1"><span class="pl-pds">"</span>https://edulify.github.io/modules/releases/<span class="pl-pds">"</span></span>))(<span class="pl-en">Resolver</span>.ivyStylePatterns)
)</pre></div>

<h4>
<a id="projectbuildscala" class="anchor" href="#projectbuildscala" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>project/Build.scala</code>
</h4>

<div class="highlight highlight-scala"><pre><span class="pl-k">import</span> <span class="pl-v">sbt.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">Keys.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.Project.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">ApplicationBuild</span> <span class="pl-k">extends</span> <span class="pl-e">Build</span> {

  <span class="pl-k">val</span> <span class="pl-en">appName</span>         <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>geolocation-java-sample<span class="pl-pds">"</span></span>
  <span class="pl-k">val</span> <span class="pl-en">appVersion</span>      <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>1.0-SNAPSHOT<span class="pl-pds">"</span></span>

  <span class="pl-k">val</span> <span class="pl-en">appDependencies</span> <span class="pl-k">=</span> <span class="pl-en">Seq</span>(
    <span class="pl-c">// Add your project dependencies here,</span>
    javaCore,
    javaJdbc,
    javaEbean,
    <span class="pl-s1"><span class="pl-pds">"</span>com.edulify<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s1"><span class="pl-pds">"</span>geolocation<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s1"><span class="pl-pds">"</span>1.4.0<span class="pl-pds">"</span></span>
  )

  <span class="pl-k">val</span> <span class="pl-en">main</span> <span class="pl-k">=</span> play.<span class="pl-en">Project</span>(appName, appVersion, appDependencies).settings(
    <span class="pl-c">// Add your own project settings here</span>
    resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.url(<span class="pl-s1"><span class="pl-pds">"</span>Edulify Repository<span class="pl-pds">"</span></span>, url(<span class="pl-s1"><span class="pl-pds">"</span>https://edulify.github.io/modules/releases/<span class="pl-pds">"</span></span>))(<span class="pl-en">Resolver</span>.ivyStylePatterns)
  )

}
</pre></div>

<h4>
<a id="add-plugin-class-to-your-projectplayplugins" class="anchor" href="#add-plugin-class-to-your-projectplayplugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add plugin class to your <code>project/play.plugins</code>:</h4>

<p>Add the following line in your <code>play.plugins</code> file:</p>

<pre><code>1600:com.edulify.modules.geolocation.GeolocationPlugin
</code></pre>

<p>Use a number greater than <code>1000</code> since <a href="https://playframework.com/documentation/2.3.x/ScalaPlugins">play reserves this number to its own plugins</a>.</p>

<h2>
<a id="configurations" class="anchor" href="#configurations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configurations</h2>

<p>This plugins offers the following configurations:</p>

<table>
<thead>
<tr>
<th align="left">Configuration</th>
<th align="left">Description</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>geolocation.provider</code></td>
<td align="left">The geolocation provider implementation</td>
<td align="left"><code>com.edulify.modules.geolocation.providers.FreegeoipProvider</code></td>
</tr>
<tr>
<td align="left"><code>geolocation.cache.on</code></td>
<td align="left">Caches geolocation results calls</td>
<td align="left"><code>false</code></td>
</tr>
<tr>
<td align="left"><code>geolocation.cache.ttl</code></td>
<td align="left">How long it should cache the results</td>
<td align="left">none</td>
</tr>
<tr>
<td align="left"><code>geolocation.enabled</code></td>
<td align="left">If the plugin is enabled or not</td>
<td align="left"><code>true</code></td>
</tr>
<tr>
<td align="left"><code>geolocation.timeout</code></td>
<td align="left">How long it should waits to retrieve the geolocation</td>
<td align="left"><code>5s</code></td>
</tr>
<tr>
<td align="left"><code>geolocation.maxmind.license</code></td>
<td align="left">Maxmind license</td>
<td align="left">none</td>
</tr>
</tbody>
</table>

<p>Per instance, you can add the following in your <code>conf/application.conf</code>:</p>

<pre><code>geolocation {
  provider = "com.edulify.modules.geolocation.providers.MaxmindProvider"
  timeout = 1s
  cache {
    on = true
    ttl = 10s
  }
  maxmind.license = "your-maxmind-license"
}
</code></pre>

<p>Also, notice that the cache uses the cache support offered by Playframework.</p>

<h2>
<a id="code-example" class="anchor" href="#code-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code example</h2>

<p>Right now there is support to both async and sync geolocation calls, both using <a href="https://playframework.com/documentation/2.3.x/JavaWS">the Play WS API</a>. </p>

<h3>
<a id="async-example-code" class="anchor" href="#async-example-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Async Example Code</h3>

<p>This is the expected way to use the plugin.</p>

<div class="highlight highlight-java"><pre><span class="pl-k">import</span> <span class="pl-smi">com.edulify.modules.geolocation.Geolocation</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.edulify.modules.geolocation.AsyncGeolocationService</span>;

<span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Application</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">Result</span> <span class="pl-en">index</span>() {
    <span class="pl-c1">...</span>
    <span class="pl-st">Promise&lt;<span class="pl-stj">Geolocation</span>&gt;</span> promise <span class="pl-k">=</span> <span class="pl-stj">AsyncGeolocationService</span><span class="pl-k">.</span>getGeolocation(request<span class="pl-k">.</span>remoteAddress());
    <span class="pl-k">return</span> promise<span class="pl-k">.</span>map(<span class="pl-k">new</span> <span class="pl-st">Function&lt;<span class="pl-stj">Geolocation</span>, <span class="pl-stj">Result</span>&gt;</span>() {
      <span class="pl-c1">...</span>
    });
  }
}</pre></div>

<h3>
<a id="sync-example-code-deprecated" class="anchor" href="#sync-example-code-deprecated" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sync Example code (DEPRECATED):</h3>

<p>This will be removed in a future release and it is exists just to keep compatibility.</p>

<div class="highlight highlight-java"><pre><span class="pl-k">import</span> <span class="pl-smi">com.edulify.modules.geolocation.Geolocation</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.edulify.modules.geolocation.GeolocationService</span>;

<span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Application</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">Result</span> <span class="pl-en">index</span>() {
    <span class="pl-c1">...</span>
    <span class="pl-stj">Geolocation</span> geolocation <span class="pl-k">=</span> <span class="pl-stj">GeolocationService</span><span class="pl-k">.</span>getGeolocation(request<span class="pl-k">.</span>remoteAddress());
    <span class="pl-k">return</span> ok(viewGeolocation<span class="pl-k">.</span>render(geolocation));
  }
}</pre></div>

<h2>
<a id="implement-your-own-geolocation-service-provider" class="anchor" href="#implement-your-own-geolocation-service-provider" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implement your own geolocation service provider</h2>

<p>Out of the box, this plugins supports just Maxmind and Freegeoip, but you can add your own geolocation service provider implementation and everything will works as expected. To do that, just create an implementation of <code>com.edulify.modules.geolocation.GeolocationProvider</code> and then configure it:</p>

<div class="highlight highlight-java"><pre><span class="pl-k">package</span> <span class="pl-smp">com.acme.geolocation</span>;

<span class="pl-k">import</span> <span class="pl-smi">com.edulify.modules.geolocation.Geolocation</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.edulify.modules.geolocation.GeolocationProvider</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.libs.F</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.libs.ws.WS</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.libs.ws.WSResponse</span>;

<span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MyGeolocationProvider</span> <span class="pl-s">implements</span> <span class="pl-e">GeolocationProvider</span> {

    <span class="pl-st">@Override</span>
    <span class="pl-s">public</span> <span class="pl-stj">F</span>.<span class="pl-st">Promise&lt;<span class="pl-stj">Geolocation</span>&gt;</span> <span class="pl-en">get</span>(<span class="pl-stj">String</span> <span class="pl-v">ip</span>) {
        <span class="pl-c">// Do a request to your geolocation service and </span>
        <span class="pl-c">// then return a Promise with a geolocation object</span>
    }
}</pre></div>

<p>After that, you just have to configure the provider:</p>

<pre><code>geolocation {
  provider = "com.acme.geolocation.MyGeolocationProvider"
  timeout = 1s
  cache {
    on = true
    ttl = 10s
  }
}
</code></pre>

<p>Things like cache and timeouts will work seamless.</p>

<h2>
<a id="more-plugins-from-edulifycom" class="anchor" href="#more-plugins-from-edulifycom" aria-hidden="true"><span class="octicon octicon-link"></span></a>More plugins from <a href="https://edulify.com">Edulify.com</a>
</h2>

<ol>
<li><a href="https://github.com/edulify/play-sitemap-module.edulify.com">Sitemap Plugin</a></li>
<li><a href="https://github.com/edulify/play-hikaricp.edulify.com">HikariCP Plugin</a></li>
<li><a href="https://github.com/edulify/play-currency-converter-module.edulify.com">Currency Plugin</a></li>
</ol>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
